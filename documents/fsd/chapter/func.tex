\chapter{Functional Specifications}
\label{ch:func}

\newcounter{counterFS}
\newcommand{\internalspec}[5]
{
    \item[FS\arabic{counterFS}\phantomsection\label{FS\arabic{counterFS}}]
    \begin{itemize}[noitemsep]
        \item[]{\textbf{#1}} %title
        \item[]{Actor: #2}
        \item[]{Precondition: #3}
        \item[]{Action: #4}
        \item[]{Postcondition: #5}
    \end{itemize}
}
\newcommand{\fspec}[6][]{\ifthenelse{\equal{#1}{}}{\setcounter{counterFS}{\intcalcAdd{\value{counterFS}}{\intcalcSub{10}{\intcalcMod{\value{counterFS}}{10}}}}}{\setcounter{counterFS}{#1}}\internalspec{#2}{#3}{#4}{#5}{#6}}
\newcommand{\fsubspec}[5]{\stepcounter{counterFS}\internalspec{#1}{#2}{#3}{#4}{#5}}

%%commonly used post-conditions
\newcommand{\sessionactive}{A \gls{session} is currently being recorded.}
\newcommand{\sessioninactive}{No \gls{session} is currently being recorded.}
\newcommand{\sessionsavail}{One or more sessions have been recorded and not deleted.}
\newcommand{\applaunched}{The application is running.}
\newcommand{\configvalid}{The configuration file is valid.}
\newcommand{\configinvalid}{The configuration file is invalid.}
This chapter is meant to organize and describe the specifications that dictate the way the application functions for different actors.

%\begin{itemize}
%    \fspec{Title1}{actor}{pre}{action}{post}
%    \fsubspec{Title2}{SubActor}{subpre}{subaction}{subpost} %%creates a sub item
%    \fspec{Title3}{actor}{pre}{action}{post} %%will automatically jump to next multiple of 10
%    \fspec[22]{Title4}{actor}{pre}{action}{post} %%set manually
%\end{itemize}

\section{High-level specification}
The user interface components mentioned in this section are specified in \ref{sec:uispec}.
\begin{itemize}
    \fspec{Identifiable \glspl{session}}{\Gls{user}}{\applaunched{} \configvalid{}}{When the user starts a \gls{session}-recording by pressing the ``Start Recording''-button, a unique session-ID gets created.}{The core application holds a session-ID which all \glspl{event} recorded during the current \gls{session} will get associated with.}
    \fspec{Event timings}{\Gls{user}}{\sessionactive}{When the user triggers an event specified in chapter \ref{ch:data}, the respective \gls{module} (see \ref{sec:modules}) generates a data-structure (see \ref{sec:events}) associated with the event and adds the timestamp to it.}{The data structure associated with the event contains a timestamp describing its time of occurence.}
    \fspec{Event types}{\Gls{user}}{\sessionactive}{When the user triggers an event specified in chapter \ref{ch:data}, the respective module (see \ref{sec:modules}) generates a data-structure (see \ref{sec:events}) associated with the event and adds the event-type to it.}{The data structure associated with the event contains a field describing its \gls{event}-type.}
    \fspec{Event processing}{\Gls{user}}{\sessionactive}{When the user triggers an event specified in chapter \ref{ch:data}, the data structure corresponding to this event is processed and filtered by \glspl{module} (see \ref{sec:modules}). If the configuration does not specify to discard the event, the event data structure is sent to the core application by the respective module.}{The event data structure is either held by the core application for serialization or deleted based on a configured rule.}
    \fspec{Configurability}{\Gls{admin}}{\sessioninactive}{An \gls{admin} opens the configuration file and adds/modifies/removes rules affecting the following behavior:
        \begin{itemize}
        \item Active \glspl{module}\\Select the \glspl{module} the application is allowed to use
        \item Framerate and video resolution\\The framerate and resolution of the recorded videostream should be configurable to allow the prioritization of either resource efficiency (storage and system load) or quality
        \item Audio\\The recording of audio needs to be toggleable
        \item Path\\The system path where the recordings of the current \gls{user} will be stored
    \end{itemize}
    }{The application will use the configuration as specified in the changed configuration file the next time it is launched.}
    \fspec{Error-checking}{\Gls{user}}{\configinvalid}{The \gls{user} starts the application. The core application checks the configuration file and detects syntactic errors, therefore the application interrupts the startup procedure.}{The application has not regularly started and is therefore not ready for recording. For UI details, see \hyperref[sec:uispec]{Error dialogue}.}
    \fspec{\Gls{user} controllability (start)}{\Gls{user}}{\applaunched{} \sessioninactive{}}{The \gls{user} clicks on the button labeled ``Start Recording''. The application starts a new \gls{session}-recording.}{\sessionactive}
    \fspec{\Gls{user} controllability (stop)}{\Gls{user}}{\sessionactive}{The \gls{user} clicks on the button labeled ``Stop Recording''. The application will stop the current \gls{session}-recording.}{\sessioninactive{} The save-dialogue is shown to the \gls{user}, providing the options to store or discard the recorded session. For UI details, see \hyperref[sec:uispec]{Save dialogue}.} %%TODO: link UI
    \fspec{\Gls{user} controllability (quit)}{\Gls{user}}{\applaunched{} \sessioninactive}{The user chooses the ``Quit'' option. The application terminates.}{The application is no longer running.}
    \fspec{Quit while recording}{\Gls{user}}{\applaunched{} \sessionactive}{The user chooses the ``Quit'' option while a session is being recorded. The application opens the save-dialogue.}{The save-dialogue is shown to the \gls{user}. The application terminates as soon as the \gls{user}'s-choice has been processed.}
    \fspec{Save-Options}{\Gls{user}}{A \gls{session}-recordings has been stopped and the save-dialogue is displayed.}{The user chooses whether to save or discard the recorded session.}{If the user chose to save the recording, the recording is stored at the location specified in the configuration file. If the user chose the discard-option, the recording is deleted.}
    \fspec{\Gls{user} instruction}{\Gls{user}}{\applaunched{} \sessioninactive{} \configvalid}{The \gls{user} clicks on the button labeled ``Start Recording''. The application opens an information dialogue.}{A dialogue is being displayed, advising the \gls{user} not to enter any personal or confidential business information.}
    \fspec{\Gls{user} reviewability}{\Gls{user}}{\sessionsavail}{A \gls{user} clicks on the ``Open recordings folder'' button. The application opens a new window, displaying the files in which this \gls{user}'s past recordings have been stored. A recording is considered to belong to the current \gls{user} if it has been created on the Windows-Account which is currently logged in.}{A window is being shown to the user, displaying the files in which his past recordings have been stored. The \gls{user} can view the videostream contained in these files by opening them with a compatible video-player, e. g. Windows Media Player.}
\end{itemize}

\section{Core application specification}
The core application has to cover the following responsibilities:
\begin{itemize}
    \fspec[200]{Videostream recording}{\Gls{user}}{\sessionactive}{While a session is being recorded, the core application constantly captures the \gls{device}'s screen's content into a videostream which it then serializes. The \gls{videostream} forms the basis for every recording.}{The \gls{session} recording contains a \gls{videostream} containing the video-output of the \gls{device}.}
    \fspec{\hyperref[sec:system-modules]{System module} invocation}{\Gls{user}}{\applaunched}{The \gls{user} clicks the ``Start recording'' button. The core application invokes the necessary \hyperref[sec:system-modules]{system modules} according to the configuration.}{All available \hyperref[sec:system-modules]{system modules} required to satisfy the configuration are active and listening for their respective \glspl{event}.}
    \fspec{\hyperref[sec:system-modules]{System module} configuration}{\Gls{user}}{\configvalid}{The \gls{user} starts the application. The core application starts to setup and configure the \hyperref[sec:system-modules]{system modules} according to the configuration.}{The \hyperref[sec:system-modules]{system modules} are configured according to the configuration and the application is ready for recording.}
    \fspec{\hyperref[sec:on-demand-modules]{On-demand module} registration}{\Gls{user}}{\sessionactive}{The \gls{user} starts an application (e.g. a \gls{browser}) which contains an \hyperref[sec:on-demand-modules]{on-demand module}. The \hyperref[sec:on-demand-modules]{on-demand module} notifies the core application about its availability. The core-application reacts by opening a communication port to the \hyperref[sec:on-demand-modules]{on-demand module} to allow for reception of event-data.}{The \hyperref[sec:on-demand-modules]{on-demand module} is ready to send filled-in \glspl{event} to the core application.}
    \fspec{\hyperref[sec:on-demand-modules]{On-demand module} initial registration}{\Gls{user}}{\applaunched{} An application containing an \hyperref[sec:on-demand-modules]{On-demand module} is already running.}{The \gls{user} clicks on the button labeled ``Start Recording''. The core application registers the available \hyperref[sec:on-demand-modules]{On-demand module} and reacts by opening a communication port to the \hyperref[sec:on-demand-modules]{on-demand-module} to allow for reception of event-data.}{The \hyperref[sec:on-demand-modules]{on-demand module} is ready to send filled-in \glspl{event} to the core application.}
    \fspec{Data consolidation}{\Gls{user}}{\sessionactive}{The \gls{user} triggers an event which is noticed by a \gls{module}. The \gls{module} sends the filled-in event to the core. The core collects events from multiple modules and stores them in the same container.}{The event-data received from all active \glspl{module} is written to the same file.}
    \fspec{Combinability of \glspl{module}}{\Gls{user}}{All modules required by the configuration are installed.}{The \gls{user} starts the application and starts a \gls{session}-recording. The core application sets up the internal processing-pipeline in such a way that it functions with the configured module-combination.}{The application is ready to record the \glspl{event} as configured.}
    \fspec{Context management}{\Gls{user}}{\sessionactive}{After interacting with an application \textbf{A}, the \gls{user} starts interacting with another application \textbf{B}. The core application registers this change and informs its modules where necessary.}{The core application holds information on the current context.} %%TODO: specifiy what context is, add to Data section if applicable
\end{itemize}

\section{User interface specification}
\label{sec:uispec}
\begin{itemize}
    \fspec[300]{\Gls{user} awareness}{\Gls{user}}{\applaunched{} \sessioninactive{} \configvalid}{The \gls{user} clicks on the button labeled ``Start Recording''. The application will start showing a yellow border along the screen edges.}{A yellow border is being drawn along the screen edges as long as the recording is active.}
    \fspec{Error dialogue}{\Gls{user}}{\configinvalid}{The \gls{user} starts the application. The application will detect syntactic errors in the configuration file and display an error-message.}{An error-dialogue is shown, informing that the current configuration is invalid. When the user clicks the ``OK'' button shown in this dialogue, the application will terminate.}
    \fspec{Save dialogue}{\Gls{user}}{\sessionactive}{The user stops the recording by pressing the ``Stop Recording'' button or the ``Quit'' button. The application opens a new dialogue.}{A dialogue window is shown to the \gls{user}, providing the options ``Save recording'' and ``Discard recording''.}
    \fspec{Event-Data extraction}{\Gls{scientist}}{\sessionsavail}{A \gls{scientist} starts the supplied command-line-tool and supplies the paths of one or multiple recordings as well as an output path as parameters. The tool will start extracting the stored event-data from the recording.}{The event-data has been extracted from the specified recordings and stored in CSV-format (comma separated values) at the location specified as output path. The recordings specified as input files have not been altered.}
    \fspec{Tray-Icon}{\Gls{user}}{\configvalid}{The user starts the application. An icon is added to the system tray, indicating that the software has been launched successfully.}{An additional icon is shown in the system tray.}
    \fspec{Tray-Menu}{\Gls{user}}{\applaunched}{The user clicks on the tray-icon. A small menu appears, providing the following options:
    \begin{itemize}
    \item ``Start recording'' or ``Stop recording'' (based on whether a session is already being recorded)
    \item ``Open recordings directory''
    \item ``Quit''
    \end{itemize}}{A small menu is shown above the tray icon, providing above options.}
\end{itemize}

\section{Per-module specification}
\label{sec:modules}
This section discusses the default \glspl{module} which will be available and ship with the application at release in order to fulfill the mandatory requirements. The data associated with each event type mentioned is discussed in chapter \ref{ch:data}.

\subsection{System modules}
\label{sec:system-modules}

System modules are \glspl{module} which communicate with the operating system. They are invoked as soon as a \gls{session}-recording is started and only terminate at the end of a recording. All system \glspl{module} are \hyperref[collecting-module]{collecting modules} as specified in \ref{sec:module-types}.

\subsubsection{Window-management module}

\begin{itemize}
    \fspec[400]{Window management events}{\Gls{user}}{\sessionactive}{When the \gls{user} performs one of the following window interactions, a specialized window \gls{event} gets created by this \gls{module} and sent to the pipeline.}{The pipeline received a filled-in window \gls{event}.}
    \begin{itemize}
    \fsubspec{Focusing a window}{\Gls{user}}{\sessionactive}{The \gls{user} focuses a window. The module creates a focus-window \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in focus-window \gls{event}.}
    \fsubspec{Moving a window}{\Gls{user}}{\sessionactive}{The \gls{user} moves a window. The module creates a move-window \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in move-window \gls{event}.}
    \fsubspec{Resizing a window}{\Gls{user}}{\sessionactive}{The \gls{user} modifies the size of a window. The module creates a resize-window \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in resize-window \gls{event}.}
    \fsubspec{Minimizing/Maximizing a window}{\Gls{user}}{\sessionactive}{The \gls{user} minimizes or maximizes a window. The module creates a minimize-window/maximize-window \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in minimize-window/maximize-window \gls{event}.}
    \end{itemize}
\end{itemize}

\subsubsection{Mouse module}

\begin{itemize}
    \fspec{Mouse interaction events}{\Gls{user}}{\sessionactive}{When the \gls{user} performs one of the following mouse inputs, a specialized mouse \gls{event} gets created by this \gls{module} and sent to the pipeline.}{The pipeline received a filled-in mouse \gls{event}.}
    \begin{itemize}
    \fsubspec{Mouse Click}{\Gls{user}}{\sessionactive}{The \gls{user} presses/releases the left/right/middle mouse button. The module creates a press/release left/right/middle mouse-button \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in press/release left/right/middle mouse-button \gls{event}.}
    \fsubspec{Scroll Wheel}{\Gls{user}}{\sessionactive}{The \gls{user} scrolls the mouse-wheel. The module creates a scroll mouse-wheel \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in scroll mouse-wheel \gls{event}.}
    \fsubspec{Mouse Movement}{\Gls{user}}{\sessionactive}{The \gls{user} moves the mouse. The module creates a mouse-movement \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in mouse-movement \gls{event}.}
    \end{itemize}
\end{itemize}

\subsubsection{Keyboard module}

\begin{itemize}
    \fspec{Keyboard interaction events}{\Gls{user}}{\sessionactive}{When the \gls{user} performs one of the following keyboard inputs, a specialized keyboard \gls{event} gets created by this \gls{module} and sent to the pipeline.}{The pipeline received a filled-in keyboard \gls{event}.}
    \begin{itemize}
    \fsubspec{Releasing/Pressing a key}{\Gls{user}}{\sessionactive}{The \gls{user} presses/releases a key. The module creates a press/release keyboard-key \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in press/release keyboard-key \gls{event}.}
    \end{itemize}
\end{itemize}

\subsubsection{Clipboard module}

\begin{itemize}
    \fspec{Clipboard events}{\Gls{user}}{\sessionactive}{When the \gls{user} performs one of the following clipboard-interactions, a specialized clipboard \gls{event} gets created by this \gls{module} and sent to the pipeline.}{The pipeline received a filled-in clipboard \gls{event}.}
    \begin{itemize}
    \fsubspec{Copying to the clipboard}{\Gls{user}}{\sessionactive}{The \gls{user} copies data to the clipboard. The module creates a clipboard-copy \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in clipboard-copy \gls{event}.}
    \fsubspec{Pasting from the clipboard}{\Gls{user}}{\sessionactive}{The \gls{user} pastes data from the clipboard. The module creates a clipboard-paste \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in clipboard-paste \gls{event}.}
    \end{itemize}
\end{itemize}

\subsection{On-demand modules}
\label{sec:on-demand-modules}

On-demand modules are \glspl{module} which are dynamically run or stopped based on the software they are tracking. These \glspl{module} need to register with the application core at runtime. All on-demand \glspl{module} are \hyperref[collecting-module]{collecting modules} as specified in \ref{sec:module-types}.
\subsubsection{Browser module}

\begin{itemize}
    \fspec{Browser events}{\Gls{user}}{\sessionactive}{When the \gls{user} performs one of the following browser-interactions, a specialized browser \gls{event} gets created by this \gls{module} and sent to the pipeline.}{The pipeline received a filled-in browser \gls{event}.}
    \begin{itemize}
    \fsubspec{Opening a new tab}{\Gls{user}}{\sessionactive}{The \gls{user} opens a new tab in the \gls{browser}. The module creates an open-tab \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in open-tab \gls{event}.}
    \fsubspec{Switching to a tab}{\Gls{user}}{\sessionactive}{The \gls{user} switches to a tab in the \gls{browser}. The module creates a switch-tab \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in switch-tab \gls{event}.}
    \fsubspec{Closing a tab}{\Gls{user}}{\sessionactive}{The \gls{user} closes a tab in the \gls{browser}. The module creates a close-tab \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in close-tab \gls{event}.}
    \fsubspec{Navigation}{\Gls{user}}{\sessionactive}{The \gls{user} navigates to an URL. The module creates a navigation \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in navigation \gls{event}.}
    \fsubspec{Text-Input}{\Gls{user}}{\sessionactive}{The \gls{user} inputs text into a form or textbox. The module creates a text-input \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in text-input \gls{event}.}
    \fsubspec{Text-Selection}{\Gls{user}}{\sessionactive}{The \gls{user} selects text on a website. The module creates a text-selection \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in text-selection \gls{event}.}
    \fsubspec{Hovering}{\Gls{user}}{\sessionactive}{The \gls{user} hovers the mouse-pointer over a web-element. The module creates a hover \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in hover \gls{event}.}
    \fsubspec{File download}{\Gls{user}}{\sessionactive}{The \gls{user} downloads a file. The module creates a download \gls{event} and sends it to the pipeline.}{The pipeline received a filled-in download \gls{event}.}
    \end{itemize}
\end{itemize}