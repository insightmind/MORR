\chapter{Functional Specifications}
\label{ch:func}

\newcounter{counterFS}
\newcommand{\internalspec}[5]
{
    \item[FS\arabic{counterFS}\phantomsection\label{FS\arabic{counterFS}}]
    \begin{itemize}[noitemsep]
        \item[]{\textbf{#1}} %title
        \item[]{Actor: #2}
        \item[]{Precondition: #3}
        \item[]{Action: #4}
        \item[]{Postcondition: #5}
    \end{itemize}
}
\newcommand{\fspec}[6][]{\ifthenelse{\equal{#1}{}}{\setcounter{counterFS}{\intcalcAdd{\value{counterFS}}{\intcalcSub{10}{\intcalcMod{\value{counterFS}}{10}}}}}{\setcounter{counterFS}{#1}}\internalspec{#2}{#3}{#4}{#5}{#6}}
\newcommand{\fsubspec}[5]{\stepcounter{counterFS}\internalspec{#1}{#2}{#3}{#4}{#5}}

%%commonly used post-conditions
\newcommand{\sessionactive}{A \gls{session} is currently being recorded.}
\newcommand{\sessioninactive}{No \gls{session} is currently being recorded.}
\newcommand{\sessionsavail}{One or more sessions have been recorded and not deleted.}
\newcommand{\applaunched}{The application is running.}
\newcommand{\configvalid}{The configuration file is valid.}
\newcommand{\configinvalid}{The configuration file is invalid.}
This chapter is meant to organize and describe the specifications that dictate the way the application functions for different actors.

%\begin{itemize}
%    \fspec{Title1}{actor}{pre}{action}{post}
%    \fsubspec{Title2}{SubActor}{subpre}{subaction}{subpost} %%creates a sub item
%    \fspec{Title3}{actor}{pre}{action}{post} %%will automatically jump to next multiple of 10
%    \fspec[22]{Title4}{actor}{pre}{action}{post} %%set manually
%\end{itemize}

\section{High-level specification}
The user interface components mentioned in this section are specified in \ref{sec:uispec}.
\begin{itemize}
    \fspec{Identifiable \glspl{session}}{\Gls{user}}{\applaunched{} \configvalid{}}{When the user starts a \gls{session}-recording by pressing the ``Start Recording''-button, a unique session-ID gets created.}{The core application holds a session-ID which all \glspl{event} recorded during the current \gls{session} will get associated with.}
    \fspec{Event timings}{\Gls{user}}{\sessionactive}{When the user triggers an event specified in chapter \ref{ch:data}, the respective \gls{module} (see \ref{sec:modules}) generates a data-structure (see \ref{sec:events}) associated with the event and add the timestamp to it.}{The data structure associated with the event contains a timestamp describing its time of occurence.}
    \fspec{Event types}{\Gls{user}}{\sessionactive}{When the user triggers an event specified in chapter \ref{ch:data}, the respective module (see \ref{sec:modules}) generates a data-structure (see \ref{sec:events}) associated with the event and add the event-type to it.}{The data structure associated with the event contains a field describing its \gls{event}-type.}
    \fspec{Event processing}{\Gls{user}}{\sessionactive}{When the user triggers an event specified in chapter \ref{ch:data}, the data structure according to this event is processed and filtered by \glspl{module} (see \ref{sec:modules}). If the configuration does not specify to discard the event, the event data structure is sent to the core application by the respective module.}{The event data structure is either held by the core application for serialization or deleted based on a configured rule.}
    \fspec{Configurability}{\Gls{admin}}{\sessioninactive}{An \gls{admin} opens the configuration file and adds/modifies/removes rules affecting the following behavior:
        \begin{itemize}
        \item Active \glspl{module}\\Select the \glspl{module} the application is allowed to use
        \item Framerate and video resolution\\The framerate and resolution of the recorded videostream should be configurable to allow the prioritization of either resource efficiency (storage and system load) or quality
        \item Audio\\The recording of audio needs to be toggleable
        \item Path\\The system path where the recordings of the current \gls{user} will be stored
    \end{itemize}
    }{The application will use the configuration as specified in the changed configuration file the next time it is launched.}
    \fspec{Error-checking}{\Gls{user}}{\configinvalid}{The \Gls{user} starts the application. The core application checks the configuration file and detects syntactic errors, therefore the application interrupts the startup procedure.}{The application has not regularly started and is therefore not ready for recording.} %%TODO: link UI
    \fspec{\Gls{user} controllability (start)}{\Gls{user}}{\applaunched{} \sessioninactive{}}{The \gls{user} clicks on the button labeled ``Start Recording''. The application starts a new \gls{session}-recording.}{\sessionactive} %%TODO: link UI
    \fspec{\Gls{user} controllability (stop)}{\Gls{user}}{\sessionactive}{The \gls{user} clicks on the button labeled ``Stop Recording''. The application will stop the current \gls{session}-recording.}{\sessioninactive{} The save-dialogue is shown to the \gls{user}, providing the options to store or discard the recorded session.} %%TODO: link UI
    \fspec{\Gls{user} controllability (quit)}{\Gls{user}}{\applaunched{} \sessioninactive}{The user chooses the ``Quit'' option. The application terminates.}{The application is no longer running.}
    \fspec{Quit while recording}{\Gls{user}}{\applaunched{} \sessionactive}{The user chooses the ``Quit'' option while a session is being recorded. The application opens the save-dialogue.}{The save-dialogue is shown to the \gls{user}. The application terminates as soon as the \gls{user}'s-choice has been processed.}
    \fspec{Save-Options}{\Gls{user}}{A \gls{session}-recordings has been stopped and the save-dialogue is displayed.}{The user either chooses whether to save or discard the recorded session.}{If the user chose to save the recording, the recording is stored at the location specified in the configuration file. If the user chose the discard-option, the recording is deleted.}
    \fspec{\Gls{user} instruction}{\Gls{user}}{\applaunched{} \sessioninactive{} \configvalid}{The \gls{user} clicks on the button labeled ``Start Recording''. The application opens an information dialogue.}{A dialogue is being displayed, advising the \gls{user} not to enter any personal or confidential business information.}
    \fspec{\Gls{user} reviewability}{\Gls{user}}{\sessionsavail}{A \gls{user} clicks on the ``Open recordings folder'' button. The application opens a new window, displaying the files in which this \gls{user}'s past recordings have been stored. A recording is considered to belong to the current \gls{user} if it has been created on the Windows-Account which is currently logged in.}{A window is being shown to the user, displaying the files in which his past recordings have been stored. The \gls{user} can view the videostream contained in these files by opening them with a compatible video-player, e. g. Windows Media Player.}
\end{itemize}

\section{Core application specification}
The core application has to cover the following responsibilities:
\begin{itemize}
    \fspec[200]{Videostream recording}{}{\sessionactive}{}{Each \gls{session} recording contains a \gls{videostream} containing the video-output of the computer in use. The \gls{videostream} forms the basis for every recording.}
    \fspec{\hyperref[sec:system-modules]{System module} invocation}{}{}{}{The application core is responsible for launching \hyperref[sec:system-modules]{system modules} based on availability and global configuration.}
    \fspec{\hyperref[sec:system-modules]{System module} configuration}{}{}{}{The application core is responsible for configuring \hyperref[sec:system-modules]{system modules} based on global configuration.}
    \fspec{\hyperref[sec:on-demand-modules]{On-demand module} detection}{}{\sessionactive}{}{The application core is responsible for listening for incoming connections from \hyperref[sec:on-demand-modules]{on-demand modules} which are realized as extensions to third party software, such as browser-extensions.}
    \fspec{Data consolidation}{}{\sessionactive}{}{The data received from different \glspl{module} needs to be stored in the same container.}
    \fspec{Combinability of \glspl{module}}{}{}{}{The application core needs to be able to function with arbitrary combinations of enabled \glspl{module}.}
    \fspec{Context management}{}{\sessionactive}{}{The application core needs to track the context in which \glspl{event} occur and notify \glspl{module} of changes to it.}
\end{itemize}

\section{User interface specification}
\label{sec:uispec}
\begin{itemize}
    \fspec[300]{\Gls{user} awareness}{\Gls{user}}{\applaunched{} \sessioninactive{} \configvalid}{The \gls{user} clicks on the button labeled ``Start Recording''. The application will start showing a yellow border along the screen edges.}{A yellow border is being drawn along the screen edges as long as the recording is active.}
    \fspec{Error-checking}{\Gls{user}}{\applaunched{} \configinvalid}{The \gls{user} clicks on the button labeled ``Start Recording''. The application will detect syntactic errors in the configuration file and display an error-message.}{An error-dialogue is shown, informing that the current configuration is invalid. When the user clicks the ``OK'' button shown in this dialogue, the application will terminate.}
    \fspec{Save-Dialogue}{\Gls{user}}{\sessionactive}{The user stops the recording by pressing the ``Stop Recording'' button. The application opens a new dialogue.}{A dialogue window is shown to the \gls{user}, providing the options ``Save recording'' and ``Discard recording''.}
    \fspec{Event-Data extraction}{\Gls{scientist}}{\sessionsavail}{A \gls{scientist} starts the supplied command-line-tool and supplies the paths of one or multiple recordings as well as an output path as parameters. The tool will start extracting the stored event-data from the recording.}{The event-data has been extracted from the specified recordings and stored in CSV-format (comma separated values) at the location specified as output path. The recordings specified as input files have not been altered.}
    \fspec{Tray-Icon}{\Gls{user}}{\configvalid}{The user starts the application. An icon is added to the windows-system-tray, indicating that the software has been launched successfully.}{An additional icon is shown in the windows-system-tray.}
    \fspec{Tray-Menu}{\Gls{user}}{\applaunched}{The user clicks on the tray-icon. A small menu appears, providing following options:
    \begin{itemize}
    \item ``Start recording'' or ``Stop recording'' (based on whether a session is already being recorded)
    \item ``Open recordings directory''
    \item ``Quit''
    \end{itemize}}{A small menu is shown above the tray icon, providing above options.}
\end{itemize}

\section{Per-module specification}
\label{sec:modules}
This section discusses the default \glspl{module} which will be available and ship with the application at release in order to fulfill the mandatory requirements.

\subsection{System modules}
\label{sec:system-modules}

System modules are \glspl{module} which communicate with the operating system. They are invoked as soon as a \gls{session} is started and only terminate at the end of a \gls{session}. All system \glspl{module} are \hyperref[collecting-module]{collecting modules} as specified in \ref{sec:module-types}.

\subsubsection{Window-management module}

\begin{itemize}
    \fspec[400]{}{}{\sessionactive}{}{The application should record the following interactions with other application's windows:
    \begin{itemize}
        \item Focusing a window
        \item Moving a window
        \item Resizing a window
        \item Minimizing/Maximizing a window
    \end{itemize}}
\end{itemize}

\subsubsection{Mouse module}

\begin{itemize}
    \fspec{}{}{\sessionactive}{}{The application should record the following interactions with the \gls{device}'s mouse:
    \begin{itemize}
        \item Pressing and releasing the left mouse button
        \item Pressing and releasing the right mouse button
        \item Using the scroll wheel
        \item Moving the mouse
    \end{itemize}}
\end{itemize}

\subsubsection{Keyboard module}

\begin{itemize}
    \fspec{}{}{\sessionactive}{}{The application should record the following interactions with the \gls{device}'s keyboard:
    \begin{itemize}
        \item Pressing and releasing a key
    \end{itemize}}
\end{itemize}

\subsubsection{Clipboard module}

\begin{itemize}
    \fspec{}{}{\sessionactive}{}{The application should record the following interactions with the \gls{device}'s clipboard:
    \begin{itemize}
        \item Copying to and pasting from the clipboard
    \end{itemize}}
\end{itemize}

\subsection{On-demand modules}
\label{sec:on-demand-modules}

On-demand modules are \glspl{module} which are dynamically run or stopped based on the software they are tracking. These \glspl{module} need to register with the application core at runtime. All on-demand \glspl{module} are \hyperref[collecting-module]{collecting modules} as specified in \ref{sec:module-types}.
\subsubsection{Browser module}

\begin{itemize}
    \fspec{}{}{\sessionactive}{}{The application should record the following interactions with the browser:
    \begin{itemize}
        \item Opening a new tab
        \item Switching to a tab
        \item Closing a tab
        \item Navigating to a web page
        \item Entering text into a form or input textbox
        \item Selecting text
        \item Hovering over an element %potentially not supported by the extention API
        \item Downloading a file %e. g. data exports as mentioned in the website overview
    \end{itemize}}
\end{itemize}